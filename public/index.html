<!DOCTYPE html>
<html>
<head>
  <title>Domestika Course Downloader</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css" />
  <style>
    body {
      padding: 2em;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    .button {
      display: inline-block;
    }

     textarea {
       width: 80%;
     }
  </style>
</head>
<body>
<h1>Domestika Course Downloader</h1>

<form id="myForm">
  <label for="arg1">Domestika session cookie</label>
  <textarea id="arg1" name="arg1" required></textarea>

  <label for="arg2">Domestika credentials cookie</label>
  <textarea id="arg2" name="arg2" required></textarea>

  <label for="textarea">Domestika course URLs</label>
  <textarea id="textarea" name="textarea" required style="height:150px"></textarea>
<br/>
  <input type="submit" value="Add">
</form>

<hr>

<table id="data-table" class="u-full-width table-bordered">
  <thead>
  <tr>
    <th>Message</th>
  </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const form = document.getElementById('myForm');

  const tableBody = document.getElementById('data-table');

  const socket = new WebSocket('ws://localhost:3000');

  socket.addEventListener('open', (event) => {
    console.log('WebSocket connection established');
  });

  socket.addEventListener('message', (event) => {
    const data = JSON.parse(event.data);
    console.log('Received JSON data:', data);

    // Clear the table body
    tableBody.innerHTML = '';

    // Populate the table with the new data
    data.forEach((course) => {
      course.allVideos.forEach((video) => {
        const row = document.createElement('tr');
        let messageCell = document.createElement('td');
        messageCell.textContent = video.videoData[0].status;
        row.appendChild(messageCell);
         messageCell = document.createElement('td');
        messageCell.textContent = course.courseTitle + ' ' +  video.title + ' ' +  video.videoData[0].title ;
        row.appendChild(messageCell);
        tableBody.appendChild(row);
      })
    });
  });

  socket.addEventListener('close', (event) => {
    console.log('WebSocket connection closed');

    // Reconnect when the HTML page is reopened
    setTimeout(() => {
      const socket = new WebSocket('ws://localhost:3000');
      // Add event listeners and handle incoming messages as needed
    }, 1000);
  });

  function appendMessageToTextArea(message) {
    logsTextarea.value += message + '\n';
  }

  form.addEventListener('submit', async (event) => {
    event.preventDefault();

    // Manually construct the request body as a JSON object
    const requestBody = {
      arg1: form.arg1.value,
      arg2: form.arg2.value,
      textarea: form.textarea.value,
    };
    const response = await fetch('/submit', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(requestBody),
    });
  });
</script>
</body>
</html>
